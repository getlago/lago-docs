<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-guide/intro/billing-nightmare">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.3.1">
<title data-rh="true">Why billing is a nightmare | Lago documentation</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://getlago.com/docs/guide/intro/billing-nightmare"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Why billing is a nightmare | Lago documentation"><meta data-rh="true" name="description" content="The original version of this article is available on our blog."><meta data-rh="true" property="og:description" content="The original version of this article is available on our blog."><link data-rh="true" rel="icon" href="/img/lago.ico"><link data-rh="true" rel="alternate" href="https://getlago.com/docs/guide/intro/billing-nightmare" hreflang="en"><link data-rh="true" rel="alternate" href="https://getlago.com/docs/guide/intro/billing-nightmare" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://PGTV8J052Y-dsn.algolia.net" crossorigin="anonymous"><link data-rh="true" rel="canonical" href="https://www.getlago.com/blog/why-billing-systems-are-a-nightmare-for-engineers"><link rel="alternate" type="application/rss+xml" href="/changelog/rss.xml" title="Lago documentation RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/changelog/atom.xml" title="Lago documentation Atom Feed">
<link rel="alternate" type="application/json" href="/changelog/feed.json" title="Lago documentation JSON Feed">



<link rel="search" type="application/opensearchdescription+xml" title="Lago documentation" href="/opensearch.xml"><link rel="stylesheet" href="/assets/css/styles.7a3f4903.css">
<link rel="preload" href="/assets/js/runtime~main.add3da9a.js" as="script">
<link rel="preload" href="/assets/js/main.561ca600.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" target="_self" href="/docs/guide/intro/welcome"><div class="navbar__logo"><img src="/img/logo.svg" alt="Lago" class="themedImage_ToTc themedImage--light_HNdA"><img src="/img/logo.svg" alt="Lago" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">Lago</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/category/introduction">Guide</a><a class="navbar__item navbar__link" href="/docs/api/intro">API Reference</a><a class="navbar__item navbar__link" href="/docs/integrations/intro">Integrations</a></div><div class="navbar__items navbar__items--right"><a class="navbar__item navbar__link" href="/changelog">Changelog</a><a href="https://github.com/getlago/lago" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><a href="https://forms.gle/eT7zgqcvq8dgt94g7" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Book a demo</a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebarViewport_Xe31"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" aria-expanded="true" href="/docs/category/introduction">Introduction</a><button aria-label="Toggle the collapsible sidebar category &#x27;Introduction&#x27;" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/guide/intro/welcome">Welcome to Lago</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/guide/intro/billing-nightmare">Why billing is a nightmare</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/lago-self-hosted">Lago Self-hosted</a><button aria-label="Toggle the collapsible sidebar category &#x27;Lago Self-hosted&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/guide/lago-cloud">Lago Cloud</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/billable-metrics">Billable metrics</a><button aria-label="Toggle the collapsible sidebar category &#x27;Billable metrics&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/plans">Plans</a><button aria-label="Toggle the collapsible sidebar category &#x27;Plans&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/guide/customers">Customers</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/guide/coupons">Coupons</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/guide/addons">Add-ons</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/events">Events</a><button aria-label="Toggle the collapsible sidebar category &#x27;Events&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/invoicing">Invoicing</a><button aria-label="Toggle the collapsible sidebar category &#x27;Invoicing&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" aria-expanded="false" href="/docs/category/payments">Payments</a><button aria-label="Toggle the collapsible sidebar category &#x27;Payments&#x27;" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/guide/credit_notes">Credit notes</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/guide/prepaid_credits">Prepaid credits</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/guide/entitlements">Entitlements</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/guide/testing-integration">Integration testing</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/guide/openapi">Lago Open API</a></li></ul></nav></div></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/introduction"><span itemprop="name">Introduction</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Why billing is a nightmare</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Why billing is a nightmare</h1><div class="theme-admonition theme-admonition-info alert alert--info admonition_LlT9"><div class="admonitionHeading_tbUL"><span class="admonitionIcon_kALy"><svg viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></span>info</div><div class="admonitionContent_S0QG"><p>The original version of this article is available on <a href="https://www.getlago.com/blog/why-billing-systems-are-a-nightmare-for-engineers" target="_blank" rel="noopener noreferrer">our blog</a>.</p></div></div><blockquote><p><em>&quot;On my first day, I was told: &#x27;Payment will come later, shouldn&#x27;t be hard right?&#x27;</em></p><p><em>I was worried. We were not selling and delivering goods, but SSDs and CPU cores, petabytes and milliseconds, space and time. Instantly, via API. Fungible, at the smallest unit. On all continents. That was the vision.</em></p><p><em>After a week, I felt like I was the only one really concerned about the long road ahead. In ambitious enterprise projects, complexity compounds quickly: multi-tenancy, multi-users, multi-roles, multi-currency, multi-tax codes, multi-everything. These systems were no fun, some were ancient, and often &#x27;spaghetti-like&#x27;.</em></p><p><em>What should have been a one-year R&amp;D project ended up taking seven years of my professional life, in which I grew the billing team from 0 to 12 people. So yes, if you ask me, billing is hard. Harder than you think. It&#x27;s time to solve that once and for all.&quot;</em></p><p>Kevin Deldycke, former VP Engineering at Scaleway</p></blockquote><p>This is a typical conversation we have with engineers on a daily basis.</p><p>After my last post about my <a href="https://www.getlago.com/blog/pricing-my-only-growth-hack-at-qonto" target="_blank" rel="noopener noreferrer">&#x27;pricing hack&#x27;</a>, some of you asked me why billing was that complex. My co-founder Raffi took up the challenge of explaining why it&#x27;s still an unsolved problem for engineers. </p><p>We also gathered insights from other friends who went through the same painful journey, including Algolia, Segment, Pleo... don&#x27;t miss them! Passing the mic to Raffi.</p><p>When you&#x27;re thinking about automating billing, this means your company is getting traction. That&#x27;s good news! </p><p>You might then wonder: should we build it in-house? It does not look complex, and the logic seems specific to your business. Also, you might want to preserve your precious margins and therefore avoid existing billing solutions like Stripe Billing or Chargebee, that take a cut of your revenue. Honestly, who likes this &#x27;rent-seeker&#x27; approach? </p><p>Our team at Lago still has some painful memories of Qonto&#x27;s internal billing system, that we had to build and maintain. Why was it so painful?  In this article, I will provide a high-level view of the technical challenges we faced while implementing hybrid pricing (based on subscription and usage) and what we learned during this journey.</p><p><img loading="lazy" alt="How engineers feel about building a billing system" src="/assets/images/billing-nightmare-3c8b70de58b169f0a4f882549c9edcb7.png" width="2912" height="1676" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="tldr-billing-is-just-100x-harder-than-you-will-ever-think">TL;DR: Billing is just 100x harder than you will ever think<a href="#tldr-billing-is-just-100x-harder-than-you-will-ever-think" class="hash-link" aria-label="Direct link to TL;DR: Billing is just 100x harder than you will ever think" title="Direct link to TL;DR: Billing is just 100x harder than you will ever think">​</a></h2><p>&quot;Let&#x27;s bill yearly as well, should be pretty straightforward&quot; claims the Revenue team. Great! Everyone is excited to start working on it. Everyone, except the Tech team. When you start building your internal billing system, it&#x27;s hard to think of all the complexity that will pop up down the road, unless you&#x27;ve experienced it before.</p><p>It&#x27;s common to start a business with a simple pricing. You define one or two price plans and limit this pricing to a defined number of features. However, when the company is growing, your pricing gets more and more complex, just like your entire codebase.</p><p>At Qonto, our first users could only onboard on a €9 plan. We quickly decided to add plans, and &#x27;pay-as-you-go&#x27; features (e.g. ATM withdrawals, foreign currency payments, capital deposit, etc.) to grow revenue.</p><p>Also, as Qonto is a neobank, we wanted to charge our customers&#x27; wallets directly, through a ledger connected to our internal billing system. The team  started from a duo of full-time engineers building a billing system (which is already a considerable investment) to a dedicated cross-functional Pricing team.</p><p>This is not specific to Qonto of course. Pleo, another fintech unicorn from Denmark faced similar issues:</p><blockquote><p><em>&quot;I&#x27;ve learned to appreciate that billing systems are hard to build, hard to design, and hard to get working for you if you deviate from &#x27;the standard&#x27; even by a tiny bit.&quot;</em></p><p>Arnon Shimoni, Product Billing Infrastructure Lead at Pleo</p></blockquote><p>This is not even specific to fintechs. The Algolia team ended up creating a whole pricing department, now led by Djay, a pricing and monetization veteran from Twilio, VMWare, Service Now. They switched to a &#x27;pay-as-you-go&#x27; pricing model based on the number of monthly API searches.</p><blockquote><p><em>&quot;It looks easy on paper — however, it&#x27;s a challenge to bring automation and transparency to a customer, so they can easily understand. There is a lot of behind-the-scenes work that goes into this, and it takes a lot of engineering and investment to do it the right way.&quot;</em></p><p>Bernardette Nixon, CEO at Venture Beat</p></blockquote><h2 class="anchor anchorWithStickyNavbar_LWe7" id="dates">Dates<a href="#dates" class="hash-link" aria-label="Direct link to Dates" title="Direct link to Dates">​</a></h2><p>When implementing a billing system, dealing with dates is often the number 1 complexity. Somehow, all your subscriptions and charges are based on a number of days. Whether you make your customers pay weekly, monthly or yearly, you need to define the billing period.</p><p>Here is a non-exhaustive list of difficulties for engineers:</p><ol><li>How to deal with leap years?</li><li>Do your subscriptions start at the beginning of the month or at the creation date of the customer?</li><li>How many days/months of trial do you offer?</li><li>Who decided February only holds 28 days?</li><li>Wait, point 1 is also important for February...</li><li>How to calculate usage-based charges (price per second, hour, day)?</li><li>Do I resume the consumption or do I stack it month over month? Year over year?</li><li>Do I apply a pro-rata based on the number of days consumed by my customer?</li></ol><p>Although every decision is reversible, billing cycle questions are often the most important source of customer support tickets, and iterating on them is quite complex. For instance, Qonto switched from &#x27;anniversary&#x27; dates to calendar dates for its billing periods (see <a href="https://medium.com/qonto-way/biller-migration-how-we-changed-our-billing-cycle-cf3c4cdd7cf4" target="_blank" rel="noopener noreferrer">here</a>). This change was not trivial.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="upgrades--downgrades">Upgrades &amp; Downgrades<a href="#upgrades--downgrades" class="hash-link" aria-label="Direct link to Upgrades &amp; Downgrades" title="Direct link to Upgrades &amp; Downgrades">​</a></h2><p>You need to allow your customers to upgrade or downgrade their subscriptions. Moving from plan A to plan B seems pretty easy, but it&#x27;s not. Let&#x27;s zoom on potential edge cases.</p><p>What should we do when the user:</p><ol><li>Upgrades or downgrades in the middle of a period;</li><li>Has paid for the original plan in advance;</li><li>Needs to pay for the original plan in arrears;</li><li>Downgrades from a yearly plan to a monthly plan;</li><li>Upgrades from a monthly plan to a yearly plan;</li><li>Upgrades or downgrades from a plan paid in advance to a plan paid in arrears (and vice-versa); or</li><li>Has a discount and upgrades/downgrades?</li></ol><p>We did not have a free trial period at the time at Qonto, but Arnon from Pleo describes this situation <a href="https://arnon.dk/5-things-i-learned-developing-billing-system/" target="_blank" rel="noopener noreferrer">here</a>.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="usage-based-computations">Usage-based computations<a href="#usage-based-computations" class="hash-link" aria-label="Direct link to Usage-based computations" title="Direct link to Usage-based computations">​</a></h2><p>Subscription-based billing is the first step when implementing a billing system. Each customer needs to be affiliated to a plan in order to start charging the right amount at the right time.</p><p>But for a growing number of companies, like Qonto, other charges come alongside this subscription. These charges are based on what customers really consume. This is what we call &#x27;usage-based billing&#x27;. Most companies end up having a hybrid pricing model: a monthly subscription fee and &#x27;add-ons&#x27; or &#x27;pay-as-you-go&#x27; charges on top of it.</p><p>These consumption-based charges are tough to track at scale, because they often come with calculation rules performed on a high volume of events.</p><p>Here are some examples:</p><p>Segment&#x27;s pricing is based on the number of monthly tracked users. This means that they need to count the distinct number of users each month and reset this value to zero for the next billing period. In order to retrieve the number of unique visitors, they need to apply a &#x27;distinct&#x27; function to deduplicate them.</p><p><img loading="lazy" alt="Event related to tracked users" src="/assets/images/tracked-users-event-f81fc6d343efffad1c4b3355517d90db.png" width="1360" height="670" class="img_ev3q"></p><p><img loading="lazy" alt="Event aggregation for tracked users" src="/assets/images/tracked-users-aggregation-1c662afae3af55c1d1b43793d0f56cc8.png" width="1360" height="596" class="img_ev3q"></p><p>Algolia tracks the number of API searches per month. This means they need to sum the number of monthly searches for each customer and reset this value to zero for the next billing period.</p><p><img loading="lazy" alt="Event related to API searches" src="/assets/images/api-search-event-9e90f7f9c063238a4e14cfd03d314a1e.png" width="1360" height="670" class="img_ev3q"></p><p><img loading="lazy" alt="Event aggregation for API searches" src="/assets/images/api-search-aggregation-23924f13dd3da2e5d73388afffe7e89a.png" width="1360" height="596" class="img_ev3q"></p><p>It becomes even more complex when you start calculating charges based on a timeframe. For instance, Snowflake charges for the compute usage of a data warehouse per second. This means that they sum the number of gigabytes or terabytes consumed, multiplied by the number of seconds of compute time.</p><p>Consider the example of a utility company that charges $10 per kilowatt of electricity per hour. The illustration below shows what needs to be modeled and automated by the billing system.</p><p><img loading="lazy" alt="Power consumption diagram" src="/assets/images/power-consumption-aba79c1bc4259e79144011519a519586.png" width="2232" height="1464" class="img_ev3q"></p><ul><li><strong>Hour 1</strong>: 10 KW used for 0.5 hour = 5 KW (10 x 0.5)</li><li><strong>Hour 2</strong>: 20 KW used for 1 hour = 20 KW (20 x 1)</li><li><strong>Hour 3</strong>: 0 KW used for 1 hour = 0 KW (0 x 1)</li><li><strong>Hour 4</strong>: 30 KW used for 0.5 hour = 15 KW (30 x 0.5)</li><li><strong>TOTAL</strong> = 40 KW used x $10 ⇒ $40</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="idempotency-done-right">Idempotency done right<a href="#idempotency-done-right" class="hash-link" aria-label="Direct link to Idempotency done right" title="Direct link to Idempotency done right">​</a></h2><p>Billing errors sometimes occur. Charging a user twice for the same product is obviously bad for the customer experience, but failing to charge when needed hurts revenue. That&#x27;s partly why Finance and BI teams spend so much time on revenue recognition.</p><p>For &#x27;pay-as-you-go&#x27; companies, the billing system will process a high volume of events. When an event needs to be replayed, it needs to happen without billing the user again. Engineers call it &#x27;idempotency&#x27;, which means the <strong>ability to apply the same operation multiple times without changing the result beyond the first try</strong>.</p><p>It&#x27;s a simple design principle, however, maintaining it at all times is hard.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-case-for-a-cash-collection-officer">The case for a Cash Collection Officer<a href="#the-case-for-a-cash-collection-officer" class="hash-link" aria-label="Direct link to The case for a Cash Collection Officer" title="Direct link to The case for a Cash Collection Officer">​</a></h2><p>Cash collection is the process of collecting the money that customers owe you. The pet peeve of cash collection is dunning: when payments fail, the merchant needs to persist and make repeated payment requests to their customers, while trying not to damage the relationship.</p><p>At Qonto, we called these &#x27;waiting funds&#x27;. A client&#x27;s status was &#x27;waiting funds&#x27; when they successfully went through the sign-up, KYC and KYB process but their account balance was still 0.</p><p>For a neobank, the impact is twofold: you can&#x27;t charge your service fees (e.g. monthly subscription) and your customer does not generate interchange revenues (e.g. when you make a payment of $100 with your card, the card issuer earns $0.5-$1 of interchange revenue through the merchant&#x27;s fees).</p><p>Therefore, your two main revenue streams are &#x27;null&#x27; but you did pay to acquire, onboard, KYC the user and then to produce and send them a card. We often half-joked about the need to hire a &#x27;chief waiting funds officer&#x27;: the financial impact of this is just as high as the problem is underestimated.</p><p>All companies face dunning challenges. For engineers, on top of the billing architecture, this means that they need to design and build:</p><ol><li>A <strong>&#x27;retry logic&#x27;</strong> to ask for a new payment intent;</li><li>An <strong>invoice reconciliation system</strong> (e.g. if several months of charges are recovered);</li><li>An <strong>app logic to disable access</strong> to the service; and</li><li>An <strong>emailing workflow</strong> to urge a user to proceed to the payment.</li></ol><p>Some SaaS are even on a mission to fight dunnings and have built full-fledged companies around cash collection, such as Upflow, which is used by successful B2B scale-ups, including Front and Lattice.</p><blockquote><p><em>&quot;Sending quality and personalized reminders took us a lot of time and, as Lattice was growing fast, it was essential for us to scale our cash collection processes. We use Upflow to personalize how we ask our customers for money, repeatedly, while keeping a good relationship. We now collect 99% of our invoices, effortlessly.&quot;</em></p><p>Jason Lopez, Controller at Lattice</p></blockquote><h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-labyrinth-of-taxes-and-vat">The labyrinth of taxes and VAT<a href="#the-labyrinth-of-taxes-and-vat" class="hash-link" aria-label="Direct link to The labyrinth of taxes and VAT" title="Direct link to The labyrinth of taxes and VAT">​</a></h2><p>Taxes are challenging and depend on multiple dimensions. Taxes depend on what you are selling, your home country and your customer&#x27;s home country. In the simplest situations, your tax decision tree should look like this:</p><p><img loading="lazy" alt="Decision tree for taxes" src="/assets/images/taxes-vat-46fc3b96167c21bc33b279431aa187ca.png" width="4056" height="1720" class="img_ev3q"></p><p>Now, imagine that you sell different types of goods/services to different types of customers in 100+ countries. If you think the logic on paper looks complex, the engineering challenge is tenfold. Engineers need to think of an entire tax logic within the application. This pyramidal logic is based on customers and products, including:</p><ol><li><strong>Taxes at company level</strong>: your company will have a general tax rate that applies to all customers by default;</li><li><strong>Taxes at customer level</strong>: the default tax rate can be overridden for each customer, depending on the dimensions mentioned above (see illustration); and</li><li><strong>Taxes at feature level</strong>: this is mostly the case for the banking industry. At Qonto for instance, banking fees are not subject to taxes but a 20% VAT rate applies to non-banking features.</li></ol><p>With billing, the devil&#x27;s in the detail, which is why I always cringe when I see engineering teams build a home-made system, just because they think &quot;it&#x27;s not that complex&quot;.</p><p>If you&#x27;ve already tackled the topics listed above and think it&#x27;s a good investment of your engineering time, go ahead and build it in-house, but make sure to budget for the maintenance work that is always needed. Another option is to rely on existing billing platforms, built by specialized teams.</p><p>To solve this problem at scale, we&#x27;ve adopted a radical approach: we&#x27;re building an open-source billing API for product-led SaaS. Our API and architecture are open, so that you can embed, fork and customize them as much as your pricing and internal processes require.</p><p>If you&#x27;re interested, you can <a href="https://www.getlago.com/get-started" target="_blank" rel="noopener noreferrer">get started</a> here or <a href="https://forms.gle/eT7zgqcvq8dgt94g7" target="_blank" rel="noopener noreferrer">book a demo</a>.</p></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/guide/intro/welcome"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Welcome to Lago</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/category/lago-self-hosted"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Lago Self-hosted</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#tldr-billing-is-just-100x-harder-than-you-will-ever-think" class="table-of-contents__link toc-highlight">TL;DR: Billing is just 100x harder than you will ever think</a></li><li><a href="#dates" class="table-of-contents__link toc-highlight">Dates</a></li><li><a href="#upgrades--downgrades" class="table-of-contents__link toc-highlight">Upgrades &amp; Downgrades</a></li><li><a href="#usage-based-computations" class="table-of-contents__link toc-highlight">Usage-based computations</a></li><li><a href="#idempotency-done-right" class="table-of-contents__link toc-highlight">Idempotency done right</a></li><li><a href="#the-case-for-a-cash-collection-officer" class="table-of-contents__link toc-highlight">The case for a Cash Collection Officer</a></li><li><a href="#the-labyrinth-of-taxes-and-vat" class="table-of-contents__link toc-highlight">The labyrinth of taxes and VAT</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/guide/intro/welcome">Guide</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/api/intro">API Reference</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.getlago.com/slack" target="_blank" rel="noopener noreferrer" class="footer__link-item">Slack<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://twitter.com/GetLago" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://forms.gle/eT7zgqcvq8dgt94g7" target="_blank" rel="noopener noreferrer" class="footer__link-item">Book a demo<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/getlago/lago" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 - Lago.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.add3da9a.js"></script>
<script src="/assets/js/main.561ca600.js"></script>
</body>
</html>