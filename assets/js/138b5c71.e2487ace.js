"use strict";(self.webpackChunklago_doc=self.webpackChunklago_doc||[]).push([[4579],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>y});var a=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=a.createContext({}),d=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=d(e.components);return a.createElement(l.Provider,{value:t},e.children)},u="mdxType",p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,r=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),u=d(n),m=o,y=u["".concat(l,".").concat(m)]||u[m]||p[m]||r;return n?a.createElement(y,i(i({ref:t},c),{},{components:n})):a.createElement(y,i({ref:t},c))}));function y(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var r=n.length,i=new Array(r);i[0]=m;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[u]="string"==typeof e?e:o,i[1]=s;for(var d=2;d<r;d++)i[d]=n[d];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},1595:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>p,frontMatter:()=>r,metadata:()=>s,toc:()=>d});var a=n(87462),o=(n(67294),n(3905));const r={sidebar_position:4},i="Adyen integration",s={unversionedId:"guide/payments/adyen-integration",id:"guide/payments/adyen-integration",title:"Adyen integration",description:"Lago's seamless integration with Adyen offers a wide range of payment options, enabling you to conveniently collect payments from your customers. Supported payment methods include:",source:"@site/docs/guide/11_payments/adyen-integration.md",sourceDirName:"guide/11_payments",slug:"/guide/payments/adyen-integration",permalink:"/docs/guide/payments/adyen-integration",draft:!1,tags:[],version:"current",sidebarPosition:4,frontMatter:{sidebar_position:4},sidebar:"guide",previous:{title:"Stripe integration",permalink:"/docs/guide/payments/stripe-integration"},next:{title:"Payment retries",permalink:"/docs/guide/payments/payment-retries"}},l={},d=[{value:"Connecting Lago to Adyen",id:"connecting-lago-to-adyen",level:2},{value:"Adyen Connection Fields",id:"adyen-connection-fields",level:2},{value:"1. API Key (mandatory)",id:"1-api-key-mandatory",level:3},{value:"2. Merchant Account (mandatory)",id:"2-merchant-account-mandatory",level:3},{value:"3. Live Prefix (optional)",id:"3-live-prefix-optional",level:3},{value:"4. HMAC Signature (optional)",id:"4-hmac-signature-optional",level:3},{value:"Setting up Adyen&#39;s Payments Auto Capture",id:"setting-up-adyens-payments-auto-capture",level:2},{value:"Setting up Adyen Webhook for Listening to Important Events",id:"setting-up-adyen-webhook-for-listening-to-important-events",level:2},{value:"Setting Adyen as a Payment Provider for a Customer",id:"setting-adyen-as-a-payment-provider-for-a-customer",level:2},{value:"Adding a new customer in Adyen",id:"adding-a-new-customer-in-adyen",level:3},{value:"Using an existing customer from Adyen",id:"using-an-existing-customer-from-adyen",level:3},{value:"Adyen Checkout: Storing Customer&#39;s Payment Method Information",id:"adyen-checkout-storing-customers-payment-method-information",level:2},{value:"Creating Payments from Lago Invoices",id:"creating-payments-from-lago-invoices",level:2},{value:"Creating Refunds from Lago Credit Notes",id:"creating-refunds-from-lago-credit-notes",level:2}],c={toc:d},u="wrapper";function p(e){let{components:t,...r}=e;return(0,o.kt)(u,(0,a.Z)({},c,r,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"adyen-integration"},"Adyen integration"),(0,o.kt)("p",null,"Lago's seamless integration with Adyen offers a wide range of payment options, enabling you to conveniently collect payments from your customers. Supported payment methods include:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Card payments (Visa, MasterCard, CB)"),(0,o.kt)("li",{parentName:"ul"},"Apple Pay"),(0,o.kt)("li",{parentName:"ul"},"Paypal"),(0,o.kt)("li",{parentName:"ul"},"American Express"),(0,o.kt)("li",{parentName:"ul"},"Amazon Pay"),(0,o.kt)("li",{parentName:"ul"},"Google Pay")),(0,o.kt)("p",null,"And many more! With Lago's native Adyen integration, you can offer your customers a variety of payment options, enhancing their convenience and flexibility during transactions."),(0,o.kt)("h2",{id:"connecting-lago-to-adyen"},"Connecting Lago to Adyen"),(0,o.kt)("p",null,"To set up the Adyen integration in Lago from our user interface, follow these steps:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"In the side menu of your Lago app, navigate to ",(0,o.kt)("strong",{parentName:"li"},"Settings"),";"),(0,o.kt)("li",{parentName:"ol"},"Select the ",(0,o.kt)("strong",{parentName:"li"},"Integrations")," tab;"),(0,o.kt)("li",{parentName:"ol"},"Click on ",(0,o.kt)("strong",{parentName:"li"},"Adyen")," and enter the required connection fields (described in the next section); and"),(0,o.kt)("li",{parentName:"ol"},"Click ",(0,o.kt)("strong",{parentName:"li"},"Connect to Adyen")," to confirm the integration.")),(0,o.kt)("h2",{id:"adyen-connection-fields"},"Adyen Connection Fields"),(0,o.kt)("p",null,"When connecting Lago to Adyen, you need to provide information for the following fields."),(0,o.kt)("h3",{id:"1-api-key-mandatory"},"1. API Key (mandatory)"),(0,o.kt)("p",null,"The API Key is a mandatory field and can be found in your Adyen account. Follow these steps to retrieve the API Key:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Go to your Adyen account and navigate to ",(0,o.kt)("strong",{parentName:"li"},"Developers")," > ",(0,o.kt)("strong",{parentName:"li"},"API Credentials"),";"),(0,o.kt)("li",{parentName:"ul"},"On the API Credentials page, create new credentials with a type of ",(0,o.kt)("strong",{parentName:"li"},"Web service user"),";"),(0,o.kt)("li",{parentName:"ul"},"Click on the ",(0,o.kt)("strong",{parentName:"li"},"Create credentials")," button to generate the API Key; and"),(0,o.kt)("li",{parentName:"ul"},"Copy the API Key and paste it in the corresponding field in Lago. Remember to save the changes.")),(0,o.kt)("h3",{id:"2-merchant-account-mandatory"},"2. Merchant Account (mandatory)"),(0,o.kt)("p",null,"The Merchant Account is required to ensure that Lago targets the correct Adyen account. To find the Merchant Account:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Go to ",(0,o.kt)("strong",{parentName:"li"},"Settings")," > ",(0,o.kt)("strong",{parentName:"li"},"Merchant accounts")," in your Adyen account; and"),(0,o.kt)("li",{parentName:"ul"},"Copy the ",(0,o.kt)("strong",{parentName:"li"},"Account code")," of the targeted account you want to use with Lago.")),(0,o.kt)("h3",{id:"3-live-prefix-optional"},"3. Live Prefix (optional)"),(0,o.kt)("p",null,"The Live Prefix represents the prefix url of your live Adyen account. This field is optional. If left empty, you can connect a test account. However, for live accounts, you must provide a Live Prefix. Follow these steps to obtain the Live Prefix:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Go to ",(0,o.kt)("strong",{parentName:"li"},"Developers")," > ",(0,o.kt)("strong",{parentName:"li"},"API URLs")," > ",(0,o.kt)("strong",{parentName:"li"},"Prefix")," in your Adyen account.")),(0,o.kt)("h3",{id:"4-hmac-signature-optional"},"4. HMAC Signature (optional)"),(0,o.kt)("p",null,"Adyen's HMAC signatures are used to protect webhook endpoints and messages created by Adyen. Lago requires this signature to properly decrypt outgoing webhooks from Adyen. To find the HMAC Signature:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Create or edit a webhook in Adyen by accessing ",(0,o.kt)("strong",{parentName:"li"},"Developers")," > ",(0,o.kt)("strong",{parentName:"li"},"Webhooks"),"; and"),(0,o.kt)("li",{parentName:"ul"},'Under "Security" settings, you can find the HMAC Key.')),(0,o.kt)("admonition",{type:"tip"},(0,o.kt)("p",{parentName:"admonition"},"The Live Prefix and HMAC Signature fields are optional and may not be required depending on your use case.")),(0,o.kt)("h2",{id:"setting-up-adyens-payments-auto-capture"},"Setting up Adyen's Payments Auto Capture"),(0,o.kt)("p",null,"To enable automatic payment capture in your Adyen account, ensure that you have configured the account settings accordingly. Automatic payment capture allows for immediate processing without manual intervention. Refer to Adyen's documentation for instructions on ",(0,o.kt)("a",{parentName:"p",href:"https://docs.adyen.com/online-payments/capture#automatic-capture"},"setting up auto capture"),"."),(0,o.kt)("h2",{id:"setting-up-adyen-webhook-for-listening-to-important-events"},"Setting up Adyen Webhook for Listening to Important Events"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"This step is crucial and mandatory")," for Lago to receive and process messages from Adyen, enabling functionalities such as customer creation/update, payment processing, and refunds. To configure Adyen webhook and establish communication with Lago, follow the steps below:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Access your Adyen application and navigate to the ",(0,o.kt)("strong",{parentName:"li"},"Developers")," section;"),(0,o.kt)("li",{parentName:"ol"},"Select ",(0,o.kt)("strong",{parentName:"li"},"Webhooks")," and create a new webhook of type ",(0,o.kt)("strong",{parentName:"li"},"Standard"),";"),(0,o.kt)("li",{parentName:"ol"},"In the ",(0,o.kt)("strong",{parentName:"li"},"Server configuration")," section, locate the ",(0,o.kt)("strong",{parentName:"li"},"General")," settings; and"),(0,o.kt)("li",{parentName:"ol"},"Copy and paste the following URL: ",(0,o.kt)("strong",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"strong"},"https://api.getlago.com/webhooks/adyen/{{your_organization_id}}"))," (don't forget to change the prefix ",(0,o.kt)("inlineCode",{parentName:"li"},"your_organization_id"),")")),(0,o.kt)("admonition",{type:"tip"},(0,o.kt)("p",{parentName:"admonition"},"You can find your Organization ID in Lago under the Developers section, specifically in ",(0,o.kt)("strong",{parentName:"p"},"API keys & ID")," > ",(0,o.kt)("strong",{parentName:"p"},"Organization ID"),".")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"Please ensure that you complete this setup correctly, as your Adyen integration will not function without this vital step.")),(0,o.kt)("h2",{id:"setting-adyen-as-a-payment-provider-for-a-customer"},"Setting Adyen as a Payment Provider for a Customer"),(0,o.kt)("p",null,"In order to facilitate automated payment collection, it is essential for the customer to exist in both the Lago and Adyen databases. Please note that in Adyen, customers are referred to as ",(0,o.kt)("strong",{parentName:"p"},"Shoppers"),"."),(0,o.kt)("h3",{id:"adding-a-new-customer-in-adyen"},"Adding a new customer in Adyen"),(0,o.kt)("p",null,"If the customer does not already exist in Adyen, you can create them in Lago using either the user interface or the ",(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("a",{parentName:"strong",href:"../../api/customers/create-customer"},"API")),". When providing customer information, please ensure the following:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Set Adyen as the customer's ",(0,o.kt)("strong",{parentName:"li"},"default payment provider"),";"),(0,o.kt)("li",{parentName:"ol"},"Keep the field associated with the ",(0,o.kt)("strong",{parentName:"li"},"Adyen Payment Provider Customer ID")," empty; and"),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("strong",{parentName:"li"},"Enable")," the option to automatically create the customer in Adyen.")),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Adyen as PSP for new customer",src:n(76486).Z,width:"1460",height:"1042"})),(0,o.kt)("p",null,"Once the customer is added in Lago, they will be automatically synchronized with Adyen. Adyen will generate a unique Shopper ID, which will be stored in Lago. Typically, Adyen utilizes the Lago customer's ",(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("inlineCode",{parentName:"strong"},"external_id"))," as the Shopper ID for seamless integration between the two platforms."),(0,o.kt)("p",null,"Upon successful customer creation, you will receive two ",(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("a",{parentName:"strong",href:"../../api/webhooks/messages"},"webhook messages"))," to keep you informed:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("strong",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"strong"},"customer.checkout_url_generated")),": This message includes the checkout URL that provides access to the default payment method. It allows you to perform a pre-authorization payment and store the payment method securely; and"),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("strong",{parentName:"li"},(0,o.kt)("inlineCode",{parentName:"strong"},"customer.payment_provider_created")),": This message confirms the successful creation of the customer in Adyen, indicating that the customer's details have been added to the Adyen database.")),(0,o.kt)("admonition",{type:"caution"},(0,o.kt)("p",{parentName:"admonition"},"Please note that the customer will be created in Adyen only if the payment method has been stored through the checkout URL and pre-authorization payment.")),(0,o.kt)("h3",{id:"using-an-existing-customer-from-adyen"},"Using an existing customer from Adyen"),(0,o.kt)("p",null,"If the customer and direct debit mandate already exist in Adyen, you can create the customer record in Lago using either the user interface or ",(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("a",{parentName:"strong",href:"../../api/customers/create-customer"},"the API")),". Follow these steps when adding customer information:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Set Adyen as the ",(0,o.kt)("strong",{parentName:"li"},"default payment provider")," for the customer in Lago; and"),(0,o.kt)("li",{parentName:"ol"},"Provide the ",(0,o.kt)("strong",{parentName:"li"},"Adyen ",(0,o.kt)("a",{parentName:"strong",href:"https://docs.adyen.com/point-of-sale/card-acquisition/identifiers#:~:text=Shopper%20reference%3A%20a,contract%20payments."},"Shopper Reference"))," as the Lago ",(0,o.kt)("strong",{parentName:"li"},"Payment provider customer ID"),"."),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("strong",{parentName:"li"},"Disable")," the option to automatically create the customer in Adyen.")),(0,o.kt)("p",null,"By following these steps, you can integrate an existing customer from Adyen into Lago, ensuring synchronization and consistency between the two platforms."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Adyen as PSP for existing customer",src:n(72954).Z,width:"1466",height:"666"})),(0,o.kt)("h2",{id:"adyen-checkout-storing-customers-payment-method-information"},"Adyen Checkout: Storing Customer's Payment Method Information"),(0,o.kt)("p",null,"When Lago automatically creates a customer in Adyen, you will receive a checkout link from Lago to facilitate the storage of your customer's payment method information."),(0,o.kt)("p",null,"The payload sent by Lago will have the following structure, with the checkout link stored under ",(0,o.kt)("strong",{parentName:"p"},(0,o.kt)("inlineCode",{parentName:"strong"},"checkout_url")),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "webhook_type": "customer.checkout_url_generated",\n  "object_type": "payment_provider_customer_checkout_url",\n  "payment_provider_customer_checkout_url": {\n    "lago_customer_id": "88d23508-47fd-46bb-a87e-50c50f3cb371",\n    "external_customer_id": "hooli_1234",\n    "payment_provider": "adyen",\n    "checkout_url": "https://test.adyen.link/PLEEA656869B11DF6B"\n  }\n}\n')),(0,o.kt)("admonition",{type:"info"},(0,o.kt)("p",{parentName:"admonition"},"Note: The checkout link automatically expires after 70 days.")),(0,o.kt)("p",null,"By utilizing this provided checkout link, your customers can perform a pre-authorization payment. It's important to note that the pre-authorization payment will not collect any funds from the customer. Once the pre-authorization is confirmed, Lago will send the payment method details and securely store them into Adyen for future transactions."),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Adyen checkout with Lago",src:n(27261).Z,width:"2004",height:"1106"})),(0,o.kt)("h2",{id:"creating-payments-from-lago-invoices"},"Creating Payments from Lago Invoices"),(0,o.kt)("p",null,"When a customer has Adyen defined as their payment provider, Lago seamlessly automates the process of triggering payments in Adyen whenever a new invoice is generated."),(0,o.kt)("p",null,"This integration ensures that payments are initiated in Adyen without any manual intervention. Lago's automatic payment creation saves time and effort, providing a streamlined experience for both you and your customers."),(0,o.kt)("h2",{id:"creating-refunds-from-lago-credit-notes"},"Creating Refunds from Lago Credit Notes"),(0,o.kt)("p",null,"In cases where a customer has Adyen defined as their payment provider, Lago simplifies the refund process by automatically triggering refunds in Adyen whenever a new refund is initiated through credit notes."),(0,o.kt)("p",null,"This integration eliminates the need for manual refund processing and ensures that refunds are efficiently handled in Adyen. Lago's automated refund functionality helps you maintain accurate and timely refund transactions, enhancing customer satisfaction and operational efficiency."))}p.isMDXComponent=!0},27261:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/adyen-checkout-url-c5dcd191a83f9d40c98ef16676ab2f07.png"},72954:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/existing-customer-adyen-psp-6d4137b59e1b8de9ddb901136361f55f.png"},76486:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/new-customer-in-adyen-psp-df0b7ddd5a8c63eba800a23f525fa76d.png"}}]);