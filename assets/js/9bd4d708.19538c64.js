"use strict";(self.webpackChunklago_doc=self.webpackChunklago_doc||[]).push([[8884],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>m});var a=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=a.createContext({}),u=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},c=function(e){var t=u(e.components);return a.createElement(l.Provider,{value:t},e.children)},d="mdxType",g={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},p=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,i=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),d=u(n),p=o,m=d["".concat(l,".").concat(p)]||d[p]||g[p]||i;return n?a.createElement(m,r(r({ref:t},c),{},{components:n})):a.createElement(m,r({ref:t},c))}));function m(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=n.length,r=new Array(i);r[0]=p;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[d]="string"==typeof e?e:o,r[1]=s;for(var u=2;u<i;u++)r[u]=n[u];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}p.displayName="MDXCreateElement"},44703:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>r,default:()=>g,frontMatter:()=>i,metadata:()=>s,toc:()=>u});var a=n(87462),o=(n(67294),n(3905));const i={sidebar_position:1},r="Segment.com",s={unversionedId:"integrations/usage/segment",id:"integrations/usage/segment",title:"Segment.com",description:"Segment is a powerful tool that allows you to track the usage of your customers, providing valuable insights that can help you make data-driven decisions. This data can be sent to Lago, our usage-based billing platform, to automate your billing process and ensure accurate invoicing for your customers. Here's a step-by-step guide to help you get started:",source:"@site/docs/integrations/05_usage/segment.md",sourceDirName:"integrations/05_usage",slug:"/integrations/usage/segment",permalink:"/docs/integrations/usage/segment",draft:!1,tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"integrations",previous:{title:"Usage Tracking",permalink:"/docs/category/usage-tracking"},next:{title:"Hightouch",permalink:"/docs/integrations/usage/hightouch"}},l={},u=[{value:"Prerequisites",id:"prerequisites",level:2},{value:"Send usage from Segment to Lago",id:"send-usage-from-segment-to-lago",level:2},{value:"Create a function",id:"create-a-function",level:3},{value:"Use the Destination function",id:"use-the-destination-function",level:3},{value:"Post Request to Lago events",id:"post-request-to-lago-events",level:3},{value:"Use the test mode editor",id:"use-the-test-mode-editor",level:3},{value:"Hide sensitive data",id:"hide-sensitive-data",level:3},{value:"Send usage events to Lago",id:"send-usage-events-to-lago",level:3},{value:"Segment to Lago - demo video",id:"segment-to-lago---demo-video",level:2}],c={toc:u},d="wrapper";function g(e){let{components:t,...i}=e;return(0,o.kt)(d,(0,a.Z)({},c,i,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"segmentcom"},"Segment.com"),(0,o.kt)("p",null,"Segment is a powerful tool that allows you to track the usage of your customers, providing valuable insights that can help you make data-driven decisions. This data can be sent to Lago, our usage-based billing platform, to automate your billing process and ensure accurate invoicing for your customers. Here's a step-by-step guide to help you get started:"),(0,o.kt)("h2",{id:"prerequisites"},"Prerequisites"),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"In Lago:")),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Create a Lago organization to manage your billing and invoicing;"),(0,o.kt)("li",{parentName:"ol"},"Create a Billable metric to track the usage of your customers;"),(0,o.kt)("li",{parentName:"ol"},"Create a Plan and price the above billable metric to determine the billing rates for your customers; and"),(0,o.kt)("li",{parentName:"ol"},"Create a Customer and assign the Plan.")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"In Segment:")),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Create a Segment account;"),(0,o.kt)("li",{parentName:"ol"},"Create a data source (ideally, product usage of your customer);")),(0,o.kt)("h2",{id:"send-usage-from-segment-to-lago"},"Send usage from Segment to Lago"),(0,o.kt)("h3",{id:"create-a-function"},"Create a function"),(0,o.kt)("p",null,"To accomplish this, you'll need to create a custom ",(0,o.kt)("strong",{parentName:"p"},"Function")," in Segment. This can be done by following these simple steps:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Navigate to the ",(0,o.kt)("strong",{parentName:"li"},"Catalog")," in Segment;"),(0,o.kt)("li",{parentName:"ol"},"Click the ",(0,o.kt)("strong",{parentName:"li"},"Functions")," tab to access the custom Functions feature;"),(0,o.kt)("li",{parentName:"ol"},"Choose to create your first function and follow the prompts to set it up.")),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Segment Functions",src:n(45748).Z,width:"2996",height:"1100"})),(0,o.kt)("h3",{id:"use-the-destination-function"},"Use the Destination function"),(0,o.kt)("p",null,"Make sure to select the ",(0,o.kt)("strong",{parentName:"p"},"Destination function"),", as you want to send data from Segment to Lago.\n",(0,o.kt)("img",{alt:"Destinations function",src:n(6752).Z,width:"2972",height:"1336"})),(0,o.kt)("h3",{id:"post-request-to-lago-events"},"Post Request to Lago events"),(0,o.kt)("p",null,"To successfully integrate Lago with Segment, you'll need to replace the pre-written functions in the code editor with the following code. This example function, written by the Lago team, will catch a ",(0,o.kt)("strong",{parentName:"p"},"Track")," event from Segment, define the targeted endpoint (events) in Lago, build the body of the request, and finally post the event."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-javascript"},"// Running everytime a Track call is made on Segment\nasync function onTrack(event, settings) {\n\n  // events endpoint to reach\n  const endpoint = 'https://api.getlago.com/api/v1/events';\n\n  // body of the event following Lago documentation\n    const body = {\n      event: {\n        transactionId: event.messageId,\n        externalCustomerId: event.userId,\n        code: event.event,\n        properties: {\n          invoiceId: event.properties.invoice_id\n        }\n      }\n    };\n\n    // Post event\n    const response = await fetch(endpoint, {\n      method: 'POST',\n      headers: {\n        'Authorization': `Bearer ${settings.api}`,\n        'Content-Type': 'application/json'\n      },\n      body: JSON.stringify(body)\n    });\n\n    return response.json();\n\n  }\n")),(0,o.kt)("admonition",{type:"note"},(0,o.kt)("p",{parentName:"admonition"},"This function can be adapted with Identify, Group or Page events. Please, refer to ",(0,o.kt)("a",{parentName:"p",href:"https://segment.com/docs/connections/functions/destination-functions/"},"Segment's documentation")," for all available actions.")),(0,o.kt)("admonition",{type:"note"},(0,o.kt)("p",{parentName:"admonition"},"The ",(0,o.kt)("inlineCode",{parentName:"p"},"body")," structure of the event depends on your use case. Please adapt it if needed (",(0,o.kt)("em",{parentName:"p"},"ie: remove or add properties"),"). You can also add conditions if you want to send data to Lago only on specific events.")),(0,o.kt)("h3",{id:"use-the-test-mode-editor"},"Use the test mode editor"),(0,o.kt)("p",null,"By using a sample event, you can preview the incoming data fetched from a Segment event. This will help you post a request for existing data or debug.\n",(0,o.kt)("img",{alt:"Segment Sample Events",src:n(78491).Z,width:"2980",height:"1252"})),(0,o.kt)("h3",{id:"hide-sensitive-data"},"Hide sensitive data"),(0,o.kt)("p",null,"Let's take back the example from the code written above. We decided to hide the ",(0,o.kt)("strong",{parentName:"p"},"API Key")," and mark it as sensitive information. By setting this as a variable, you make sure not to hard code your private key in the function."),(0,o.kt)("p",null,"To create ",(0,o.kt)("strong",{parentName:"p"},"Settings")," variables: "),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Go to the ",(0,o.kt)("strong",{parentName:"li"},"Settings")," tab;"),(0,o.kt)("li",{parentName:"ol"},(0,o.kt)("strong",{parentName:"li"},"Add")," a new Setting;"),(0,o.kt)("li",{parentName:"ol"},"Define a ",(0,o.kt)("strong",{parentName:"li"},"Name")," and a ",(0,o.kt)("strong",{parentName:"li"},"Label")," for this Settings;"),(0,o.kt)("li",{parentName:"ol"},"Define it as ",(0,o.kt)("strong",{parentName:"li"},"Required")," or ",(0,o.kt)("strong",{parentName:"li"},"Optional"),"; and"),(0,o.kt)("li",{parentName:"ol"},"Mark is as ",(0,o.kt)("strong",{parentName:"li"},"Sensitive")," or not.")),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"Segment Sample Events",src:n(12784).Z,width:"2972",height:"884"})),(0,o.kt)("h3",{id:"send-usage-events-to-lago"},"Send usage events to Lago"),(0,o.kt)("p",null,"By running the function in Segment, this will send a test usage to Lago events. You can retrieve this event in the events list. By finalizing the setup in Segment, the function will be automatically triggered based on your defined behavior"),(0,o.kt)("h2",{id:"segment-to-lago---demo-video"},"Segment to Lago - demo video"),(0,o.kt)("p",null,"If easier, please find a demo video explaining the full setup of custom functions to send event from Segment.com to Lago."),(0,o.kt)("iframe",{width:"700",height:"500",src:"https://www.youtube.com/embed/lyJmdh47JTE",title:"YouTube video player",frameborder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share",allowfullscreen:!0}))}g.isMDXComponent=!0},6752:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/destination-function-segment-6131770a6f0e5b7c8e7bf694ca6339b3.png"},45748:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/segment-catalog-1a7de549eb06d94a6a8ce92565e957a8.png"},12784:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/segment-settings-variable-c19b5f3de23eec11ffe475e8272dc5ff.png"},78491:(e,t,n)=>{n.d(t,{Z:()=>a});const a=n.p+"assets/images/test-mode-segment-747eee5ec2ff46a349064e3dbbf4a758.png"}}]);